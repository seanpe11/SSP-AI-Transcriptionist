---
const uploadEndpoint = import.meta.env.PUBLIC_UPLOAD_ENDPOINT || 'http://localhost:3000/upload';
---

<style>
  #audio-uploader {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 400px;
    margin: auto;
  }
</style>

<div id="audio-uploader">
  <label for="audio-input">Choose an audio file:</label>
  <input type="file" id="audio-input" accept="audio/*" />
  <button id="upload-btn">Upload</button>
</div>

<script is:client>
  document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('audio-input');
    const uploadBtn = document.getElementById('upload-btn');

    uploadBtn?.addEventListener('click', async () => {
      const file = fileInput?.files?.[0];
      if (!file) {
        alert('Please select a file first.');
        return;
      }

      const formData = new FormData();
      formData.append('audio', file);

      try {
        const response = await fetch({uploadEndpoint}, {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          alert('File uploaded and converted successfully!');
        } else {
          alert('Failed to upload file.');
        }
      } catch (err) {
        alert('An error occurred while uploading.');
        console.error(err);
      }
    });
  });
</script>
